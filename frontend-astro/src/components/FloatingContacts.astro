---
interface Props {
  phone?: string
  vkLink?: string
  telegramLink?: string
}

const { phone, vkLink, telegramLink } = Astro.props
---

<div class="floating-contacts">
  <div class="floating-contacts__label">
    Свяжитесь с нами!
  </div>

  <div class="floating-contacts__stack">
    {phone && (
      <a href={`tel:${phone}`} class="floating-contacts__btn floating-contacts__btn--phone" aria-label="Позвонить">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/>
        </svg>
      </a>
    )}
    {vkLink && (
      <a href={vkLink} target="_blank" rel="noopener noreferrer" class="floating-contacts__btn floating-contacts__btn--vk" aria-label="ВКонтакте">
        <span>vk</span>
      </a>
    )}
    {telegramLink && (
      <a href={telegramLink} target="_blank" rel="noopener noreferrer" class="floating-contacts__btn floating-contacts__btn--tg" aria-label="Telegram">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
          <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
        </svg>
      </a>
    )}
  </div>

  <button
    type="button"
    class="floating-contacts__btn floating-contacts__btn--main"
    aria-label="Открыть контакты"
  >
    <svg class="floating-contacts__icon-chat" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
    </svg>
    <svg class="floating-contacts__icon-close" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="18" y1="6" x2="6" y2="18"/>
      <line x1="6" y1="6" x2="18" y2="18"/>
    </svg>
  </button>
</div>

<script>
  function initFloatingContacts() {
    const container = document.querySelector('.floating-contacts') as HTMLElement
    if (!container) return

    const mainBtn = container.querySelector('.floating-contacts__btn--main')
    const label = container.querySelector('.floating-contacts__label') as HTMLElement

    // Auto-hide label after 5 seconds
    if (label) {
      setTimeout(() => {
        label.classList.add('floating-contacts__label--hidden')
      }, 5000)
    }

    mainBtn?.addEventListener('click', () => {
      const isOpen = container.classList.toggle('floating-contacts--open')
      mainBtn.setAttribute('aria-label', isOpen ? 'Закрыть контакты' : 'Открыть контакты')
      // Hide label when opened
      if (isOpen && label) {
        label.classList.add('floating-contacts__label--hidden')
      }
    })
  }

  initFloatingContacts()
  document.addEventListener('astro:after-swap', initFloatingContacts)
</script>

<style lang="scss">
.floating-contacts {
  position: fixed;
  right: 20px;
  bottom: 24px;
  z-index: 120;
  display: flex;
  flex-direction: column;
  align-items: center;

  &__label {
    position: absolute;
    right: 64px;
    bottom: 10px;
    padding: 8px 14px;
    background-color: #263238;
    color: #fff;
    border-radius: 6px;
    font-size: 13px;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
    white-space: nowrap;
    opacity: 1;
    transition: opacity 0.3s ease, transform 0.3s ease;

    &::after {
      content: '';
      position: absolute;
      right: -6px;
      top: 50%;
      transform: translateY(-50%);
      border-width: 6px 0 6px 6px;
      border-style: solid;
      border-color: transparent transparent transparent #263238;
    }

    &--hidden {
      opacity: 0;
      pointer-events: none;
    }
  }

  &__stack {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
  }

  &__btn {
    width: 52px;
    height: 52px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    color: #fff;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
    transition: transform 0.2s ease, box-shadow 0.2s ease;

    &:hover {
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.25);
    }

    &--main {
      background-color: rgb(255, 135, 23);
    }

    &--phone,
    &--vk,
    &--tg {
      width: 0;
      height: 0;
      opacity: 0;
      overflow: hidden;
      margin: 0;
      pointer-events: none;
      transition: width 0.2s ease, height 0.2s ease, opacity 0.2s ease, margin 0.2s ease;
    }

    &--phone {
      background-color: #000;
    }

    &--vk {
      background-color: #0077ff;
      font-size: 16px;
      font-weight: 700;
    }

    &--tg {
      background-color: #28a8ea;
    }
  }

  &__icon-close {
    display: none;
  }

  // Open state
  &--open {
    .floating-contacts__btn--main {
      background-color: #fff;
      color: #222;
    }

    .floating-contacts__btn--phone,
    .floating-contacts__btn--vk,
    .floating-contacts__btn--tg {
      width: 52px;
      height: 52px;
      opacity: 1;
      pointer-events: auto;
    }

    .floating-contacts__btn--phone {
      transition-delay: 0.1s;
    }

    .floating-contacts__btn--vk {
      transition-delay: 0.05s;
    }

    .floating-contacts__icon-chat {
      display: none;
    }

    .floating-contacts__icon-close {
      display: block;
    }

    .floating-contacts__label {
      opacity: 0;
      pointer-events: none;
    }
  }
}

@media (max-width: 768px) {
  .floating-contacts {
    right: 12px;
    bottom: 16px;

    &__btn {
      width: 44px;
      height: 44px;
      font-size: 18px;

      svg {
        width: 18px;
        height: 18px;
      }
    }

    &--open {
      .floating-contacts__btn--phone,
      .floating-contacts__btn--vk,
      .floating-contacts__btn--tg {
        width: 44px;
        height: 44px;
      }
    }

    &__label {
      display: none;
    }
  }
}
</style>
