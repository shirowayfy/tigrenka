# Игровой центр «Тигра» — веб-сайт

Веб-сайт детского развлекательного центра «Тигра» в г. Аша. Состоит из двух частей: серверный рендеринг на Astro (фронтенд) и headless CMS Strapi (бэкенд).

## Стек технологий

| Слой | Технология | Версия |
|------|-----------|--------|
| Фронтенд | Astro SSR | 5.7 |
| Адаптер | @astrojs/node | 9.1 |
| Стили | SCSS (Sass) | 1.97 |
| Шрифты | @fontsource (self-hosted) | 5.2 |
| Бэкенд / CMS | Strapi | 4.25 |
| База данных | SQLite (better-sqlite3) | 8.6 |
| Язык | JavaScript (ES Modules) | — |
| Среда выполнения | Node.js | 20.x |

## Архитектура

```
┌──────────────┐     HTTP/JSON     ┌──────────────┐
│              │  ◄──────────────  │              │
│   Astro SSR  │   REST API        │   Strapi 4   │
│   :4321      │  ──────────────►  │   :1337      │
│              │                   │              │
└──────┬───────┘                   └──────┬───────┘
       │                                  │
   Браузер                            SQLite
   (HTML готов)                    (.tmp/data.db)
```

### Бэкенд (Strapi 4)

Бэкенд построен на Strapi 4 — headless CMS с открытым кодом, работающей на Node.js. Strapi автоматически создает REST API под каждый тип контента и включает React-панель администратора для управления сайтом без участия разработчика. В качестве базы данных используется легковесная SQLite — файловая БД, не требующая отдельного сервера.

**Типы контента:**
- Одиночные типы (Single Types): главная страница, аттракционы, цены, контакты, футер, карта
- Коллекции (Collection Types): карточки преимуществ, отзывы, FAQ, команда, прайс-карточки, заявки с формы

**Скрипты:**
- `convert-images` — конвертация PNG в WebP для оптимизации размера
- `seed` — первичное заполнение базы данных контентом и загрузка изображений

### Фронтенд (Astro 5 SSR)

Фронтенд построен на Astro 5 в режиме серверного рендеринга (SSR) с адаптером `@astrojs/node`. При каждом запросе страницы Astro на сервере запрашивает данные из Strapi API, формирует готовый HTML и отдает его браузеру. Клиент получает полностью отрендеренную страницу без необходимости загружать JavaScript-фреймворк.

#### Подход: Islands Architecture

Astro использует архитектуру «островов» (Islands Architecture). Суть подхода — страница по умолчанию является статическим HTML без JavaScript. Интерактивные элементы (формы, карусели, меню) добавляются точечно как изолированные «острова», каждый из которых гидрируется независимо. В данном проекте интерактивность реализована на vanilla JS, поэтому ни один остров не тянет за собой фреймворк — браузер получает чистый HTML + минимальные скрипты.

Astro-компоненты (`.astro`) — это шаблоны, которые исполняются только на сервере. В отличие от React/Vue компонентов, они не имеют состояния, не требуют гидрации и не попадают в клиентский бандл. Результат — ноль байт фреймворка в браузере.

#### Сравнение с предыдущей версией (Vue 3 SPA)

Проект изначально был реализован как Vue 3 SPA (Single Page Application) с клиентским рендерингом. Миграция на Astro SSR решила ряд фундаментальных проблем этого подхода.

**Проблема SPA: пустой HTML.** Vue SPA отдает браузеру пустой `<div id="app"></div>`. Весь контент появляется только после загрузки и исполнения JavaScript-бандла (~77 KB: Vue 37 KB + Splide 25 KB + Vue Router 15 KB). На медленном соединении пользователь несколько секунд видит белый экран. Поисковые роботы могут не дождаться рендеринга и проиндексировать пустую страницу.

**Решение SSR: готовый HTML.** Astro формирует полный HTML на сервере. Браузер начинает отображать контент сразу после получения первых байт ответа, не дожидаясь загрузки JS. Контент виден мгновенно на любом устройстве и соединении.

| Метрика | Vue 3 SPA | Astro SSR | Что изменилось |
|---------|-----------|-----------|----------------|
| JS-бандл фреймворка | ~77 KB (Vue + Splide + Router) | 0 KB | Нет фреймворка в браузере |
| Клиентский JS всего | ~80 KB | ~5 KB (View Transitions) | В 16 раз меньше |
| First Contentful Paint | Ждет загрузки JS | Мгновенный (HTML готов) | Контент виден сразу |
| SEO meta-теги | Генерируются в JS (не видны ботам) | В серверном HTML | Полная индексация |
| Навигация | Vue Router (client-side) | View Transitions API | Плавные переходы без фреймворка |
| Мобильные слайдеры | Splide (~25 KB) | CSS scroll-snap (0 KB) | Нативное поведение браузера |
| Шрифты | Google Fonts (внешний запрос) | @fontsource (self-hosted) | Нет render-blocking запросов |

#### Выгода для бизнеса

**Скорость загрузки — конверсия и удержание.** По данным Google, 53% мобильных пользователей покидают сайт, если он загружается дольше 3 секунд. Каждая дополнительная секунда загрузки снижает конверсию на 7%. Серверный рендеринг обеспечивает отображение контента за доли секунды — посетитель сразу видит информацию о центре, цены и контакты, а не белый экран.

**SEO и поисковая выдача.** Для локального бизнеса (развлекательный центр в конкретном городе) позиция в поисковой выдаче — основной источник клиентов. SPA-сайт отдает поисковым ботам пустую страницу — мета-теги и контент генерируются в JavaScript, который бот может не исполнить. Astro SSR отдает готовый HTML с правильными `<title>`, `<meta description>`, Schema.org разметкой и Open Graph тегами для каждой страницы. Это обеспечивает корректную индексацию и привлекательное отображение в поисковой выдаче и при расшаривании в социальных сетях.

**Lighthouse и Core Web Vitals.** Google использует метрики Core Web Vitals (LCP, FID, CLS) как фактор ранжирования. Сайт с высокими показателями получает преимущество в поисковой выдаче перед конкурентами с медленными SPA-сайтами. Оптимизации (lazy loading, fetchpriority, предотвращение CLS) напрямую влияют на эти метрики.

**Стоимость владения.** Astro не требует сложной инфраструктуры — достаточно одного Node.js сервера. Отсутствие клиентского фреймворка снижает сложность кода и количество зависимостей (4 зависимости против 6 + 4 devDependencies у Vue-версии), что упрощает поддержку и обновление.

#### Ключевые технические решения

- **SSR вместо SPA** — HTML формируется на сервере, контент виден мгновенно без ожидания загрузки JS. Это критично для SEO и метрик Lighthouse (FCP, LCP).
- **0 KB JS-фреймворков** — вместо Vue/React используются нативные `.astro`-компоненты, которые компилируются в чистый HTML. Интерактивность (бургер-меню, аккордеон FAQ, карусель отзывов, форма обратной связи) реализована на vanilla JavaScript в `<script>` тегах.
- **View Transitions API** — SPA-подобные переходы между страницами без полной перезагрузки. Встроенный в Astro `<ViewTransitions />` перехватывает навигацию и плавно заменяет содержимое страницы.
- **CSS scroll-snap вместо Splide** — мобильные слайдеры реализованы через нативный CSS `scroll-snap-type`, что экономит ~25 KB библиотеки Splide. На десктопе тот же контейнер отображается как CSS Grid.
- **Self-hosted шрифты** — Montserrat и Montserrat Alternates подключены через `@fontsource` вместо Google Fonts. Шрифты загружаются из бандла приложения, исключая render-blocking запросы к внешним серверам.
- **SCSS** — стилизация через SCSS с CSS-переменными для цветовой палитры. Стили компонентов scoped (изолированы), глобальные стили в `main.scss`.

**Оптимизация производительности:**
- `loading="lazy"` на всех изображениях ниже первого экрана
- `fetchpriority="high"` на баннере (LCP-элемент)
- `width`/`height` на всех `<img>` для предотвращения сдвигов макета (CLS)
- Единый HTML-контейнер для grid/slider (без дублирования разметки)
- `loading="lazy"` на iframe карты

**Структура страниц:**

| Страница | URL | Данные из Strapi |
|----------|-----|-----------------|
| Главная | `/` | Баннер, преимущества, FAQ, команда, отзывы |
| Аттракционы | `/attractions` | Баннер, активити-парк, Xbox |
| Цены | `/prices` | Баннер, прайс-карточки |
| Контакты | `/contacts` | Адрес, телефон, ссылки |

Все страницы также включают общие секции: форму обратной связи и карту.

## Структура проекта

```
tigra-asha/
├── backend/                    # Strapi CMS
│   ├── config/                 # Конфигурация (middlewares, database)
│   ├── src/api/                # Модели контента
│   ├── scripts/
│   │   ├── convert-images.js   # PNG → WebP конвертация
│   │   └── seed.js             # Заполнение БД
│   └── .tmp/data.db            # SQLite база данных
│
├── frontend-astro/             # Astro SSR фронтенд
│   ├── src/
│   │   ├── layouts/
│   │   │   └── Layout.astro    # Главный лейаут (meta, шрифты, header/footer)
│   │   ├── pages/
│   │   │   ├── index.astro     # Главная страница
│   │   │   ├── attractions.astro
│   │   │   ├── prices.astro
│   │   │   └── contacts.astro
│   │   ├── components/         # 14 .astro компонентов
│   │   ├── api/                # 9 модулей запросов к Strapi
│   │   └── assets/
│   │       ├── styles/main.scss
│   │       └── images/
│   └── public/                 # Фавиконки, манифест
```

## Разработка и запуск

### Требования
- Node.js 20.x
- npm 6+

### Бэкенд

```bash
cd backend
npm install
npm run develop        # Запуск Strapi в режиме разработки (:1337)
```

Панель администратора доступна по адресу `http://localhost:1337/admin`. При первом запуске необходимо создать администратора.

**Первичное заполнение базы:**

```bash
npm run convert-images  # Конвертация PNG → WebP
npm run seed            # Заполнение базы контентом и изображениями
```

### Фронтенд

```bash
cd frontend-astro
npm install
npm run dev             # Запуск Astro dev-сервера (:4321)
```

### Сборка для продакшена

```bash
cd frontend-astro
npm run build           # Сборка серверного бандла
npm run preview         # Локальный запуск собранного сервера
```

## Переменные окружения

| Переменная | Где | Значение по умолчанию |
|-----------|-----|----------------------|
| `PUBLIC_STRAPI_URL` | frontend-astro/.env | `http://localhost:1337` |
